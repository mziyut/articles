---
title: Remix (ã‹ã¤Supabase) ã‚’è©¦ã™ç°¡æ˜“çš„ãªç’°å¢ƒã‚’ä½œã‚‹
tags:
  - TypeScript
  - Remix
  - Supabase
private: true
updated_at: '2024-12-04T01:43:58+09:00'
id: 17846af0fcb3b1d660eb
organization_url_name: null
slide: false
ignorePublish: false
---

## ã¯ã˜ã‚ã«

- Qiitaã§è¨˜äº‹ã‚’æ›¸ããŸã‚ã« Remix (ã‹ã¤Supabase) ã‚’è©¦ã™ç’°å¢ƒãŒæ¬²ã—ãä½œã‚‹ã¾ã§ã®æ‰‹é †ã‚’è¨˜äº‹åŒ–ã—ãŸ
- Remix <> Supabase é–“ã¯ `supabase-js` ã‚’ä½¿ã£ã¦é€šä¿¡ã™ã‚‹ã“ã¨ã¨ã—ã¾ã™
  - Prisma ã‚„ TypeORM ç­‰ä½¿ã„ãŸã„æ–¹ã¯é©å®œä¿®æ­£ã—ã¦ãã ã•ã„

## ç’°å¢ƒ

```sh
> sw_vers
ProductName:            macOS
ProductVersion:         15.1.1
BuildVersion:           24B91
> node -v
v22.11.0
```

## Supabase CLI ã®è¨­å®š

Supabase CLI ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯ä¸‹è¨˜è¨˜äº‹ã«ã¾ã¨ã‚ã¦ã‚ã‚Šã¾ã™ã®ã§ç¢ºèªã—è¨­å®šã—ã¦ãã ã•ã„ã€‚

https://qiita.com/mziyut/private/5d1727b6bbd07c379ab6

## Remix Project ã®è¨­å®š

ä»Šå›ã¯ template `remix-run/remix/templates/remix` ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

https://github.com/remix-run/remix/tree/main/templates/remix

https://remix.run/docs/ja/main/guides/templates

`npx create-remix@latest --template remix-run/remix/templates/remix` ã‚’å®Ÿè¡Œã— Remix Project ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
> npx create-remix@latest --template remix-run/remix/templates/remix
Need to install the following packages:
create-remix@2.15.0
Ok to proceed? (y) y


 remix   v2.15.0 ğŸ’¿ Let's build a better website...

   dir   Where should we create your new project?
         remix-supabase-test

      â—¼  Template: Using remix-run/remix/templates/remix...
      âœ”  Template copied

   git   Initialize a new git repository?
         No

  deps   Install dependencies with npm?
         Yes

      âœ”  Dependencies installed

  done   That's it!

         Enter your project directory using cd ./remix-supabase-auth
         Check out README.md for development and deploy instructions.

         Join the community at https://rmx.as/discord
```

`npm run dev` ã§ dev ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã™ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚

```sh
> npm run dev

> dev
> remix vite:dev

  âœ  Local:   http://localhost:5173/
  âœ  Network: use --host to expose
  âœ  press h + enter to show help
```

ã€ŒWelcome to Remixã€ã¨è¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°OKã§ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55950/ae0e135d-97c9-db41-aa43-59e978953e85.png)

## Supabase ã®åˆæœŸè¨­å®šã‚’è¡Œã†ã€‚

`supabase init` ã‚’å®Ÿè¡Œã— Supabase CLI ã‚’ä½¿ã£ã¦ Project ã‚’ç«‹ã¡ä¸Šã’ã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚
3ã¤ã»ã©è³ªå•ã•ã‚Œã‚‹ã®ã§ Y/N ã§å›ç­”ã—ã¦ãã ã•ã„ã€‚

```sh
> supabase init

Generate VS Code settings for Deno? [y/N]
Generate IntelliJ Settings for Deno? [y/N]
Finished supabase init.
```

## Supabase ã‚’ç«‹ã¡ä¸Šã’ã‚‹

`supabase start` ã‚’å®Ÿè¡Œã— Suoabase ã‚’èµ·å‹•ã—ã¾ã™ã€‚

åˆå›ã¯ Docker image ã® download ã‚’è¡Œã†ãŸã‚æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚æ™‚é–“åŠã³ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ä½™è£•ãŒã‚ã‚‹ã¨ãã«å®Ÿæ–½ã™ã‚‹ã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚

å®Ÿè¡Œå¾Œ `API URL` ç­‰ãŒ console ã«è¡¨ç¤ºã•ã‚ŒãŸã‚‰å®Œäº†ã§ã™ã€‚
`Studio URL` ã‚’é–‹ãã¨è¦‹æ…£ã‚ŒãŸ Supabase ã® console ã‚’è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

```
> supabase start

WARN: no seed files matched pattern: supabase/seed.sql
WARNING: analytics requires mounting default docker socket: /var/run/docker.sock
Started supabase local development setup.

         API URL: http://127.0.0.1:54321
     GraphQL URL: http://127.0.0.1:54321/graphql/v1
  S3 Storage URL: http://127.0.0.1:54321/storage/v1/s3
          DB URL: postgresql://postgres:postgres@127.0.0.1:54322/postgres
      Studio URL: http://127.0.0.1:54323
    Inbucket URL: http://127.0.0.1:54324
      JWT secret: super-secret-jwt-token-with-at-least-32-characters-long
        anon key: ANON_KEY_ANON_KEY_ANON_KEY_ANON_KEY_ANON_KEY
service_role key: SERVICE_ROLE_KEY_SERVICE_ROLE_KEY_SERVICE_ROLE_KEY
   S3 Access Key: S3_ACCESS_KEY_S3_ACCESS_KEY_S3_ACCESS_KEY
   S3 Secret Key: S3_SECRET_KEY_S3_SECRET_KEY_S3_SECRET_KEY
       S3 Region: local
```

## `@supabase/supabase-js` ã® install

```sh
npm install @supabase/supabase-js
```

## `.env` ã®ç”¨æ„

èµ·å‹•ã—ãŸ Supabase ã«æ¥ç¶šã§ãã‚‹ã‚ˆã†ã« `.env` ã‚’ç”¨æ„ã—ã¾ã™ã€‚
`supabase start` å®Ÿè¡Œå¾Œã«è¡¨ç¤ºã•ã‚ŒãŸã€ŒAPI URLã€åŠã³ã€Œanon keyã€ã‚’è¨­å®šã—ã¾ã™ã€‚

```sh:.env
SUPABASE_URL=http://127.0.0.1:54321
SUPABASE_ANON_KEY=ANON_KEY_ANON_KEY_ANON_KEY_ANON_KEY_ANON_KEY
```

## migration ã‚’ä½œæˆã—å®Ÿè¡Œ

`supabase migration new XXX` ã‚’å®Ÿè¡Œã— migration file ã‚’ä½œæˆã—ã¾ã™ã€‚

```
supabase migration new test
```

ä½œæˆã•ã‚ŒãŸ SQL ãƒ•ã‚¡ã‚¤ãƒ«ã« `CREATE TABLE xxx` ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚

```sql:supabase/migrations/20241203150624_test.sql
CREATE TABLE test (
  id SERIAL PRIMARY KEY NOT NULL,
  name TEXT
);
```

åˆã‚ã›ã¦ `supabase/seed.sql` ã‚‚ä½œæˆã—åˆæœŸãƒ‡ãƒ¼ã‚¿ã‚’æŒ¿å…¥ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

```sql:supabase/seed.sql
INSERT INTO test (name) VALUES ('example'), ('example2');
```

`supabase migration up` ã‚’å®Ÿè¡Œã—ã¦ migration ã‚’èµ°ã‚‰ã›ã¾ã™ã€‚

```sh
> supabase migration up
WARN: no seed files matched pattern: supabase/seed.sql
Connecting to local database...
Applying migration 20241203150624_test.sql...
Local database is up to date.
```

Studio URL ã‚’é–‹ã `test` table ãŒä½œæˆã•ã‚Œã¦ã„ã‚Œã°å®Œäº†ã§ã™ã€‚

![image.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/55950/69eb23a5-dd67-b26e-212e-017206a23491.png)

## supabase-js ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹

template ã§ä½œæˆã—ãŸ `app/routes/_index.tsx` ã«å…ˆã»ã©ä½œæˆã—ãŸ test table ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹å‡¦ç†ã‚’è¨˜è¼‰ã—ã¾ã™ã€‚
loader ã« `/` ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸã‚‰ console ã«å‡ºåŠ›ã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®šã—ã¾ã™ã€‚

```diff_tsx:app/routes/_index.tsx
  import type { MetaFunction } from "@remix-run/node";
+ import { createClient } from '@supabase/supabase-js'


+ export async function loader() {
+   const supabase = createClient(process.env.SUPABASE_URL || '', process.env.SUPABASE_ANON_KEY || '')
+   const { data } = await supabase.from('test').select()
+
+   console.table(data)
+
+   return {};
+ }
```

å®Ÿéš›ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ä¸‹è¨˜ã®ã‚ˆã†ã« å‡ºåŠ›ã•ã‚ŒãŸã‚‰å®Œäº†ã§ã™ã€‚

```sh
1:41:27 AM [vite] page reload app/routes/_index.tsx (x2)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ (index) â”‚ id â”‚ name       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ 0       â”‚ 1  â”‚ 'example'  â”‚
â”‚ 1       â”‚ 2  â”‚ 'example2' â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```

## Ref

https://supabase.com/docs/reference/javascript/initializing
